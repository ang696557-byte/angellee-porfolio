<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MIND & VOID | SYNTHESIS</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/three@0.128.0/examples/js/controls/OrbitControls.js"></script>
    
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Cinzel:wght@400;700&family=Syncopate:wght@400;700&family=Noto+Sans+SC:wght@300;400;700&family=Orbitron:wght@700;900&family=Share+Tech+Mono&family=Noto+Serif:wght@700&display=swap');

        /* --- 0. Global Settings (Main Page) --- */
        body, html { margin: 0; padding: 0; width: 100%; height: 100%; background-color: #020202; font-family: 'Noto Sans SC', sans-serif; color: #fff; overflow-x: hidden; cursor: none; }
        ::-webkit-scrollbar { width: 0; }

        /* --- 1. Main Page Styles --- */
        .film-grain {
            position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9998; opacity: 0.08;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noiseFilter'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.65' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noiseFilter)' opacity='1'/%3E%3C/svg%3E");
            animation: grain-move 8s steps(10) infinite;
        }
        @keyframes grain-move { 0%, 100% { transform: translate(0, 0); } 10% { transform: translate(-5%, -5%); } 50% { transform: translate(-10%, 5%); } 90% { transform: translate(10%, 5%); } }

        #wisp-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; z-index: 9990; mix-blend-mode: screen; }

        #audio-toggle {
            position: fixed; bottom: 30px; left: 40px; z-index: 100; font-family: 'Syncopate'; font-size: 10px; color: rgba(255,255,255,0.5); cursor: pointer; border: 1px solid rgba(255,255,255,0.2); padding: 8px 12px; transition: 0.3s; mix-blend-mode: difference;
        }
        #audio-toggle:hover { color: #ffae00; border-color: #ffae00; }
        .eq-bar { display: inline-block; width: 2px; height: 8px; background: currentColor; margin-right: 2px; animation: eq-bounce 0.5s infinite ease-in-out alternate; }
        .eq-bar:nth-child(2) { animation-delay: 0.1s; height: 12px; }
        .eq-bar:nth-child(3) { animation-delay: 0.2s; height: 6px; }
        #audio-toggle.muted .eq-bar { animation: none; height: 2px; }
        @keyframes eq-bounce { 0% { transform: scaleY(0.5); } 100% { transform: scaleY(1.5); } }

        .credits-fixed { position: fixed; bottom: 10px; width: 100%; text-align: center; font-family: 'Noto Sans SC', sans-serif; font-size: 10px; letter-spacing: 1px; color: rgba(255, 255, 255, 0.6); z-index: 200; pointer-events: none; mix-blend-mode: difference; text-transform: uppercase; }

        #soul-tree-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; mix-blend-mode: screen; opacity: 0; transition: opacity 0.5s; }
        body.active #soul-tree-canvas { opacity: 0.6; }
        .ambient-glow { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: radial-gradient(circle at 50% 100%, #2a1500 0%, #000 75%); z-index: -1; }
        #flash-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #fff; z-index: 9999; opacity: 0; pointer-events: none; transition: opacity 0.3s; }
        body.flashing #flash-overlay { opacity: 1; transition: none; }

        #start-screen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #020202; z-index: 5000; display: flex; justify-content: center; align-items: center; transition: opacity 0.5s; }
        #start-screen.hidden { display: none; }
        #box-container { position: relative; width: 260px; height: 180px; background: linear-gradient(135deg, #1a0d00, #000); border: 1px solid rgba(255, 174, 0, 0.3); box-shadow: 0 0 30px rgba(255, 69, 0, 0.15); display: flex; justify-content: center; align-items: center; color: rgba(255,255,255,0.9); font-size: 16px; letter-spacing: 4px; font-family: 'Syncopate'; cursor: pointer; transition: all 0.5s; z-index: 5001; }
        #box-container:hover { border-color: #ffae00; box-shadow: 0 0 60px rgba(255, 174, 0, 0.4); transform: scale(1.02); }

        #main-interface { position: fixed; top: 0; left: 0; width: 100%; height: 100%; opacity: 0; pointer-events: none; transition: opacity 1s ease; overflow-y: auto; overflow-x: hidden; scroll-behavior: smooth; z-index: 10; }
        body.active #main-interface { opacity: 1; pointer-events: auto; }
        
        .tree-header { height: 100vh; display: flex; flex-direction: column; justify-content: center; align-items: center; position: relative; z-index: 10; padding: 0 20px; }
        .neon-title { font-family: 'Orbitron'; font-weight: 900; font-size: 8vw; line-height: 1.1; color: transparent; -webkit-text-stroke: 2px #ffae00; text-align: center; margin-bottom: 40px; text-shadow: 0 0 20px #ffae00; animation: jellyfish 6s ease-in-out infinite; }
        @keyframes jellyfish { 0%, 100% { transform: translateY(0); } 50% { transform: translateY(-20px); } }
        
        .header-monologue {
            font-family: 'Noto Sans SC', sans-serif; font-weight: 300; font-size: 14px; line-height: 1.8; color: rgba(255, 255, 255, 0.85); text-align: center; max-width: 900px; margin: 0 auto; letter-spacing: 1.5px; text-transform: uppercase;
        }
        .header-monologue p { margin: 8px 0; }

        .content-stream { position: relative; max-width: 1200px; margin: 0 auto; padding-bottom: 100px; }
        .vine-section { position: relative; padding-top: 10vh; padding-bottom: 15vh; max-width: 1400px; margin: 0 auto; z-index: 1; }
        #global-vine-svg { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 0; pointer-events: none; overflow: visible; }
        .vine-path-bg { fill: none; stroke: rgba(255,255,255,0.1); stroke-width: 12px; stroke-linecap: round; }
        .vine-path-main { fill: none; stroke: url(#vineGradient); stroke-width: 8px; stroke-linecap: round; filter: drop-shadow(0 0 10px #ff4500); stroke-dasharray: 3000; stroke-dashoffset: 3000; transition: stroke-dashoffset 0.1s linear; }

        .intro-wide-block { width: 90%; max-width: 1200px; height: 350px; margin: 0 auto 20px auto; position: relative; z-index: 5; }
        .intro-img-box { width: 100%; height: 100%; overflow: hidden; border: 1px solid rgba(255, 174, 0, 0.5); border-radius: 4px; background: #000; }
        .intro-img-box img { width: 100%; height: 100%; object-fit: cover; }

        .section-divider {
            display: flex; flex-direction: column; align-items: center; justify-content: center;
            margin: 150px 0 100px 0; opacity: 0; transform: translateY(20px); transition: all 1s ease; position: relative; z-index: 5;
        }
        .section-divider.is-visible { opacity: 1; transform: translateY(0); }
        
        .mini-door {
            width: 70px; height: 140px; background-color: #ffae00; box-shadow: 0 0 40px #ffae00, 0 0 80px #ff4500; margin-bottom: 40px; position: relative; animation: door-pulse 3s infinite alternate;
        }
        .mini-door::after { content: ''; position: absolute; top: 50%; right: 6px; width: 6px; height: 6px; background: #000; border-radius: 50%; }
        @keyframes door-pulse { 0% { box-shadow: 0 0 30px #ffae00; opacity: 0.8; transform: scale(1); } 100% { box-shadow: 0 0 80px #ffae00, 0 0 20px #fff; opacity: 1; transform: scale(1.05); } }
        
        .divider-text { font-family: 'Orbitron', sans-serif; font-size: 16px; letter-spacing: 4px; color: rgba(255,255,255,0.95); text-transform: uppercase; text-shadow: 0 0 20px rgba(255, 174, 0, 0.5); text-align: center; }

        .node-block { display: flex; flex-direction: row; justify-content: space-between; align-items: center; margin-bottom: 100px; position: relative; z-index: 2; gap: 60px; opacity: 0; transform: translateY(50px); transition: all 1s; padding: 0 40px; }
        .node-block.is-visible { opacity: 1; transform: translateY(0); }
        .node-meta { width: 45%; min-width: 300px; }
        .node-visual { width: 50%; perspective: 800px; }

        .meta-title-bilingual { font-family: 'Noto Sans SC', sans-serif; font-weight: 700; font-size: 28px; line-height: 1.2; margin-bottom: 25px; color: #fff; }
        .meta-title-bilingual small { display: block; font-family: 'Orbitron', sans-serif; font-size: 14px; margin-top: 8px; letter-spacing: 2px; opacity: 0.9; }
        #node-1 .meta-title-bilingual small { color: #ffae00; text-shadow: 0 0 10px rgba(255,174,0,0.5); }
        #node-2 .meta-title-bilingual small { color: #ff4500; text-shadow: 0 0 10px rgba(255,69,0,0.5); }
        #node-3 .meta-title-bilingual small { color: #00aaff; text-shadow: 0 0 10px rgba(0,170,255,0.5); }

        .meta-desc-bilingual { font-family: 'Noto Sans SC', sans-serif; font-size: 14px; font-weight: 300; line-height: 1.8; color: rgba(255, 255, 255, 0.85); border-left: 2px solid rgba(255,255,255,0.15); padding-left: 20px; }
        .meta-desc-bilingual .en-text { display: block; font-family: 'Share Tech Mono', monospace; font-size: 12px; color: rgba(255, 255, 255, 0.5); margin-top: 15px; line-height: 1.6; }

        .cyber-screen { width: 100%; aspect-ratio: 4/3; position: relative; overflow: hidden; background: #000; transition: box-shadow 0.3s; }
        #node-1 .cyber-screen { box-shadow: 0 0 25px rgba(255, 174, 0, 0.3); border: 1px solid rgba(255, 174, 0, 0.2); }
        #node-2 .cyber-screen { box-shadow: 0 0 25px rgba(255, 69, 0, 0.3); border: 1px solid rgba(255, 69, 0, 0.2); }
        #node-3 .cyber-screen { box-shadow: 0 0 25px rgba(0, 150, 255, 0.4); border: 1px solid rgba(0, 150, 255, 0.3); }
        .cyber-screen .slide { position: absolute; top: 0; left: 0; width: 100%; height: 100%; background-size: cover; background-position: center top; opacity: 0; transition: opacity 1.5s ease-in-out; filter: brightness(0.8) contrast(1.1); z-index: 1; }
        .cyber-screen .slide.active { opacity: 1; transform: scale(1.05); transition: opacity 1.5s ease-in-out, transform 6s linear; }
        .screen-overlay { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 5; pointer-events: none; background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06)); background-size: 100% 4px, 6px 100%; box-shadow: inset 0 0 40px rgba(0,0,0,0.8); }
        .node-visual:hover .slide { filter: brightness(1.1) contrast(1.1); }
        .node-visual:hover .screen-overlay { opacity: 0.3; }

        #hologram-stage { position: relative; width: 100vw; height: 100vh; margin: 80px 0; background: radial-gradient(circle at center, rgba(255, 69, 0, 0.05) 0%, transparent 60%); overflow: hidden; border-top: 1px solid rgba(255, 69, 0, 0.4); border-bottom: 1px solid rgba(255, 69, 0, 0.4); }
        #three-container { width: 100%; height: 100%; position: absolute; top: 0; left: 0; z-index: 1; }
        .holo-ui { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 2; pointer-events: none; }
        .scan-line { position: absolute; top: 0; left: 0; width: 100%; height: 2px; background: #ffae00; box-shadow: 0 0 10px #ffae00; animation: scan-move 4s linear infinite; opacity: 0.5; }
        @keyframes scan-move { 0% { top: 0%; opacity: 0; } 100% { top: 100%; opacity: 0; } }

        /* ========================================= */
        /* --- GRAFFITI WALL STYLES (VOID TERMINAL) --- */
        /* ========================================= */
        #graffiti-wall-section {
            position: relative;
            width: 100%;
            padding: 120px 0;
            display: flex; justify-content: center; align-items: center;
            overflow: visible;
        }

        .void-terminal {
            position: relative;
            width: 85vw; max-width: 960px;
            aspect-ratio: 16/9;
            background: rgba(5, 5, 5, 0.7);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 50px rgba(0, 0, 0, 0.8), inset 0 0 100px rgba(0,0,0,0.5);
            z-index: 10;
            overflow: hidden;
            border-radius: 4px;
        }

        .void-terminal::after {
            content: ''; position: absolute; inset: 0; pointer-events: none;
            background: linear-gradient(rgba(18, 16, 16, 0) 50%, rgba(0, 0, 0, 0.25) 50%), linear-gradient(90deg, rgba(255, 0, 0, 0.06), rgba(0, 255, 0, 0.02), rgba(0, 0, 255, 0.06));
            background-size: 100% 4px, 6px 100%;
            opacity: 0.5; z-index: 5;
        }
        
        .void-terminal::before {
            content: ''; position: absolute; inset: 0; pointer-events: none;
            background: radial-gradient(circle at center, transparent 50%, rgba(0,0,0,0.6) 100%);
            z-index: 6;
        }

        .hud-corner {
            position: absolute; width: 40px; height: 40px;
            border-color: rgba(255, 255, 255, 0.4);
            border-style: solid;
            pointer-events: none; z-index: 20;
            transition: all 0.5s ease;
        }
        .void-terminal:hover .hud-corner { border-color: #ffae00; width: 50px; height: 50px; }
        
        .tl { top: 20px; left: 20px; border-width: 2px 0 0 2px; }
        .tr { top: 20px; right: 20px; border-width: 2px 2px 0 0; }
        .bl { bottom: 20px; left: 20px; border-width: 0 0 2px 2px; }
        .br { bottom: 20px; right: 20px; border-width: 0 2px 2px 0; }

        .hud-status {
            position: absolute; top: 25px; left: 40px; z-index: 20;
            font-family: 'Share Tech Mono', monospace; font-size: 10px; color: rgba(255,255,255,0.6);
            display: flex; flex-direction: column; gap: 4px; pointer-events: none;
        }
        .hud-rec { display: flex; align-items: center; gap: 6px; color: #ff3333; text-shadow: 0 0 5px #ff3333; }
        .hud-dot { width: 6px; height: 6px; background: #ff3333; border-radius: 50%; animation: blink 2s infinite; }
        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }

        .gw-header {
            position: absolute; top: 20px; right: 20px; z-index: 50;
            display: flex; gap: 10px;
        }
        
        .gw-btn-icon {
            width: 30px; height: 30px; 
            background: rgba(0,0,0,0.5); border: 1px solid rgba(255,255,255,0.2);
            color: rgba(255,255,255,0.8);
            display: flex; justify-content: center; align-items: center; cursor: pointer;
            transition: all 0.2s; backdrop-filter: blur(4px);
        }
        .gw-btn-icon:hover { background: #fff; color: #000; border-color: #fff; }
        .gw-btn-icon.danger:hover { background: #ff3333; color: #fff; border-color: #ff3333; }

        #gw-canvas-trail { position: absolute; inset: 0; width: 100%; height: 100%; z-index: 1; pointer-events: none; mix-blend-mode: screen; }
        #gw-objects-container { position: absolute; inset: 0; width: 100%; height: 100%; z-index: 2; overflow: hidden; pointer-events: none; }
        
        .gw-organism { 
            position: absolute; width: 100px; height: 100px; 
            top: 0; left: 0; will-change: transform; 
            pointer-events: auto; transition: none;
        }
        .gw-organism-inner {
            width: 100%; height: 100%;
            transition: transform 0.3s ease;
        }
        .gw-organism-inner img { 
            width: 100%; height: 100%; object-fit: contain; 
            filter: drop-shadow(0 0 15px rgba(255,255,255,0.1)); 
        }
        .gw-organism:hover .gw-organism-inner { transform: scale(1.1); filter: drop-shadow(0 0 20px rgba(255, 174, 0, 0.4)); }
        
        .gw-dock-wrapper {
            position: absolute; bottom: 30px; width: 100%;
            display: flex; flex-direction: column; align-items: center; gap: 10px;
            z-index: 50;
        }
        .gw-dock { display: flex; gap: 20px; }
        
        .gw-prism-btn {
            position: relative; width: 44px; height: 44px;
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 50%;
            display: flex; justify-content: center; align-items: center;
            cursor: pointer; transition: all 0.3s;
        }
        .gw-prism-btn:hover { transform: scale(1.1); background: rgba(255,255,255,0.2); border-color: #fff; box-shadow: 0 0 15px rgba(255,255,255,0.2); }
        .gw-icon-svg { width: 18px; height: 18px; stroke: rgba(255,255,255,0.7); fill: none; transition: stroke 0.3s; }
        .gw-prism-btn:hover .gw-icon-svg { stroke: #fff; }

        .gw-prism-btn.ink:hover { box-shadow: 0 0 15px rgba(255,255,255,0.3); }
        .gw-prism-btn.hiphop:hover { box-shadow: 0 0 15px rgba(255, 69, 0, 0.6); border-color: #ff4500; }
        .gw-prism-btn.hiphop:hover .gw-icon-svg { stroke: #ff4500; }
        .gw-prism-btn.acid:hover { box-shadow: 0 0 15px rgba(0, 255, 204, 0.6); border-color: #00ffcc; }
        .gw-prism-btn.acid:hover .gw-icon-svg { stroke: #00ffcc; }

        .upload-text {
            font-family: 'Syncopate'; font-size: 8px; color: rgba(255,255,255,0.4); 
            letter-spacing: 3px; text-transform: uppercase; 
            text-shadow: 0 0 10px rgba(255,255,255,0.1);
            margin-top: 5px;
        }

        /* ========================================= */
        /* --- SYNTH MODULE STYLES (BLACK GOLD REVISED) --- */
        /* ========================================= */
        #synth-section {
            position: relative;
            width: 100vw;
            height: 100vh;
            overflow: hidden;
            background-color: #020202; /* Pure Black Void */
            color: #ffffff;
            font-family: 'Syncopate', sans-serif;
            display: flex; flex-direction: column;
            border-top: 1px solid rgba(255, 174, 0, 0.2);
            border-bottom: 1px solid rgba(255, 174, 0, 0.2);
            box-sizing: border-box; /* Fix for layout sizing */
            
            /* Scoped Vars: Black & Gold Theme */
            --glass-surface: rgba(10, 10, 10, 0.25); /* More transparent */
            --glass-border: rgba(255, 174, 0, 0.15);
            --glass-highlight: rgba(255, 200, 100, 0.1);
            --accent-gold: #ffae00;
            --accent-orange: #ff4500;
            --text-muted: rgba(255, 255, 255, 0.4);
        }

        /* 1. Background Blobs (Warm & Dark) */
        .ethereal-blob {
            position: absolute;
            border-radius: 50%;
            filter: blur(100px);
            opacity: 0.25; /* Subtle */
            z-index: 0;
            animation: breathe 15s infinite alternate ease-in-out;
        }
        .blob-gold {
            width: 70vw; height: 70vw;
            background: radial-gradient(circle, var(--accent-gold), transparent 70%);
            top: -30%; left: -10%;
        }
        .blob-orange {
            width: 60vw; height: 60vw;
            background: radial-gradient(circle, var(--accent-orange), transparent 70%);
            bottom: -20%; right: -10%;
            animation-delay: -5s;
        }
        @keyframes breathe {
            0% { transform: scale(1) translate(0,0); opacity: 0.2; }
            100% { transform: scale(1.1) translate(20px, -20px); opacity: 0.35; }
        }

        /* 2. Noise Texture Overlay */
        .ethereal-noise {
            position: absolute; inset: 0;
            background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 200 200' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.8' numOctaves='3' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.05'/%3E%3C/svg%3E");
            opacity: 0.3; pointer-events: none; z-index: 1; mix-blend-mode: overlay;
        }

        /* 3. Layout Grid (UPDATED RATIOS FOR FIX) */
        .synth-layout {
            position: relative; z-index: 10;
            display: grid;
            /* Updated Column Ratio: Left 45%, Middle Auto, Right Fixed 240px */
            grid-template-columns: 45% 1fr 240px;
            grid-template-rows: 70px 1fr;
            gap: 20px;
            width: 100%; height: 100%;
            padding: 30px 40px;
            box-sizing: border-box;
        }

        /* Header Area */
        .synth-top {
            grid-column: 1 / -1;
            display: flex; justify-content: space-between; align-items: center;
            border-bottom: 1px solid var(--glass-border);
            padding-bottom: 15px;
        }
        .synth-brand h2 {
            font-weight: 700; font-size: 20px; margin: 0; letter-spacing: 4px;
            background: linear-gradient(to right, #fff, var(--accent-gold));
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
            text-shadow: 0 0 20px rgba(255, 174, 0, 0.3);
        }
        .synth-brand span { font-size: 9px; color: var(--text-muted); letter-spacing: 2px; }

        /* Controls */
        .synth-controls { display: flex; gap: 15px; }
        .glass-btn {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid var(--glass-border);
            color: var(--accent-gold);
            font-family: 'Syncopate'; font-size: 9px; padding: 8px 20px;
            border-radius: 4px;
            cursor: pointer;
            backdrop-filter: blur(5px);
            transition: all 0.3s ease;
            text-transform: uppercase; letter-spacing: 1px;
        }
        .glass-btn:hover {
            background: var(--accent-gold);
            color: #000;
            box-shadow: 0 0 20px var(--accent-gold);
            border-color: var(--accent-gold);
        }
        .glass-btn.active-play {
            background: rgba(255, 174, 0, 0.1);
            border-color: var(--accent-gold);
            box-shadow: 0 0 15px rgba(255, 174, 0, 0.2);
            color: #fff;
        }

        /* 4. Glass Panels (Translucent Obsidian) */
        .glass-panel {
            background: var(--glass-surface);
            backdrop-filter: blur(20px);
            -webkit-backdrop-filter: blur(20px);
            border: 1px solid var(--glass-border);
            border-top: 1px solid var(--glass-highlight);
            border-radius: 12px;
            padding: 20px;
            display: flex; flex-direction: column;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
            transition: border-color 0.3s;
            overflow: hidden; /* Prevent overflow */
        }
        .glass-panel:hover { border-color: rgba(255, 174, 0, 0.3); }

        .panel-title {
            font-size: 9px; color: var(--accent-gold); letter-spacing: 2px;
            margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between;
            opacity: 0.8; flex-shrink: 0;
        }
        .panel-title::after { content:''; width: 20px; height: 2px; background: var(--accent-gold); opacity: 0.5; }

        /* Left: Visualizer Image */
        .vis-container {
            flex: 1; border-radius: 8px; overflow: hidden; position: relative;
            background: #050505; border: 1px solid rgba(255,255,255,0.05);
        }
        #mainImage { width: 100%; height: 100%; object-fit: cover; opacity: 0.9; filter: sepia(50%) hue-rotate(-10deg) contrast(1.1); transition: opacity 0.5s; }
        .vis-overlay {
            position: absolute; bottom: 0; left: 0; width: 100%;
            padding: 25px;
            background: linear-gradient(to top, rgba(0,0,0,0.9), transparent);
        }
        .vis-text-lg { font-size: 36px; font-weight: 700; line-height: 1; margin-bottom: 5px; color: #fff; text-shadow: 0 0 10px rgba(0,0,0,0.8); }
        .vis-text-sm { font-size: 10px; color: var(--accent-gold); font-family: 'Share Tech Mono'; letter-spacing: 2px; text-transform: uppercase; }

        /* Middle: Info & Scope */
        .info-stack { display: flex; flex-direction: column; gap: 15px; height: 100%; overflow: hidden; }
        .desc-box {
            font-family: 'Noto Sans SC', sans-serif; font-size: 11px; line-height: 1.6; color: rgba(255,255,255,0.7);
            flex: 1; overflow-y: auto; padding-right: 5px; border-left: 2px solid rgba(255,255,255,0.1); padding-left: 10px;
            min-height: 0; /* Important for flex items to scroll */
        }
        .scope-box {
            height: 140px; /* INCREASED HEIGHT */
            background: rgba(0,0,0,0.4); border-radius: 4px;
            border: 1px solid rgba(255, 174, 0, 0.1);
            flex-shrink: 0;
        }
        
        /* Right: Sequencer List */
        .seq-list {
            display: flex; flex-direction: column; gap: 6px;
            overflow-y: auto; padding-right: 5px; height: 100%;
        }
        .seq-item {
            display: flex; align-items: center; justify-content: space-between;
            padding: 10px 14px;
            background: rgba(255,255,255,0.02);
            border-radius: 6px;
            border: 1px solid transparent;
            cursor: pointer; transition: all 0.2s;
        }
        .seq-item:hover { background: rgba(255, 174, 0, 0.05); border-color: rgba(255, 174, 0, 0.2); transform: translateX(-3px); }
        .seq-item.selected {
            background: linear-gradient(90deg, rgba(255, 174, 0, 0.1), transparent);
            border-left: 2px solid var(--accent-gold);
        }
        .seq-name { font-size: 10px; color: #eee; letter-spacing: 1px; }
        .seq-inst { font-size: 8px; color: var(--text-muted); font-family: 'Share Tech Mono'; }
        
        /* Toggle Switch */
        .seq-toggle {
            width: 24px; height: 12px; border-radius: 20px;
            background: rgba(255,255,255,0.1); position: relative;
            transition: 0.3s;
        }
        .seq-toggle::after {
            content:''; position: absolute; top: 1px; left: 1px;
            width: 10px; height: 10px; background: #666; border-radius: 50%;
            transition: 0.3s;
        }
        .seq-item.active .seq-toggle { background: rgba(255, 174, 0, 0.2); }
        .seq-item.active .seq-toggle::after { left: 13px; background: var(--accent-gold); box-shadow: 0 0 8px var(--accent-gold); }

        /* Video Preview (Mini) - 16:9 RATIO */
        .mini-video {
            width: 100%; 
            aspect-ratio: 16/9; /* FORCE 16:9 */
            background: #000; border-radius: 6px; overflow: hidden; position: relative; border: 1px solid rgba(255,255,255,0.05);
            flex-shrink: 0; /* Prevent shrinking */
        }
        #timbreVideo { width: 100%; height: 100%; object-fit: cover; opacity: 0.6; transition: opacity 0.3s; filter: grayscale(100%) sepia(80%) hue-rotate(-30deg); }
        .mini-video:hover #timbreVideo { opacity: 1; filter: none; }

        /* Play Bar */
        .play-progress {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 2px; background: rgba(255,255,255,0.05);
        }
        #play-head {
            width: 0%; height: 100%; background: var(--accent-gold);
            box-shadow: 0 0 15px var(--accent-gold);
            transition: width 0.1s linear;
        }

        /* ========================================= */
        /* --- END SYNTH STYLES --- */

        /* ========================================= */
        /* --- BLANK VOID SECTION (PLACEHOLDER) --- */
        /* ========================================= */
        #blank-void-section {
            position: relative;
            width: 100%;
            height: 100vh;
            background-color: #000000;
            z-index: 15; /* Sits between Synth (low z) and Outro (high z) */
            border-top: 1px solid #111;
            border-bottom: 1px solid #111;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        
        /* Optional placeholder text styling */
        .void-placeholder-text {
            font-family: 'Share Tech Mono', monospace;
            color: #111;
            font-size: 12px;
            letter-spacing: 2px;
            user-select: none;
        }

        #bg-canvas-synth {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            z-index: 0; opacity: 0.6; pointer-events: none;
        }

        /* --- Synth Header --- */
        .synth-header {
            height: 60px; flex-shrink: 0;
            display: flex; align-items: center; justify-content: space-between;
            padding: 0 40px;
            border-bottom: 1px solid var(--glass-border);
            backdrop-filter: blur(10px);
            z-index: 10;
        }
        .synth-logo { 
            font-weight: 200; letter-spacing: 6px; color: var(--ethereal-white); 
            font-size: 16px; text-transform: uppercase;
            text-shadow: 0 0 20px var(--glow-color);
        }
        .master-controls { display: flex; gap: 20px; align-items: center; }
        
        .btn-ethereal {
            padding: 8px 24px;
            background: rgba(255,255,255,0.02);
            border: 1px solid var(--glass-border);
            border-radius: 20px;
            color: var(--ethereal-cyan); font-size: 10px; letter-spacing: 2px;
            cursor: pointer; transition: all 0.4s ease;
            text-transform: uppercase;
        }
        .btn-ethereal:hover {
            background: var(--glow-color);
            border-color: var(--ethereal-cyan);
            color: #fff;
            box-shadow: 0 0 30px var(--glow-color);
        }

        /* --- Synth Main Layout --- */
        .synth-main {
            flex: 1; display: grid;
            grid-template-columns: 1.3fr 1fr 0.9fr; 
            gap: 20px;
            padding: 20px 40px 30px 40px;
            height: 100%; min-height: 0;
            position: relative; z-index: 5;
        }

        /* --- Synth Panels --- */
        .panel {
            background: var(--glass-bg);
            border: 1px solid var(--glass-border);
            border-radius: 12px;
            padding: 20px;
            display: flex; flex-direction: column;
            position: relative;
            backdrop-filter: blur(20px);
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            height: 100%; overflow: hidden;
        }
        .panel::before, .panel::after { content: ''; position: absolute; width: 15px; height: 15px; opacity: 0.5; }
        .panel::before { top: -1px; left: -1px; border-top: 1px solid var(--ethereal-cyan); border-left: 1px solid var(--ethereal-cyan); border-radius: 12px 0 0 0; }
        .panel::after { bottom: -1px; right: -1px; border-bottom: 1px solid var(--ethereal-cyan); border-right: 1px solid var(--ethereal-cyan); border-radius: 0 0 12px 0; }

        .panel-header {
            flex-shrink: 0; display: flex; justify-content: space-between; align-items: center;
            margin-bottom: 15px; padding-bottom: 8px;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }
        .panel-label {
            font-size: 9px; color: rgba(255,255,255,0.5); letter-spacing: 3px; text-transform: uppercase;
        }
        .panel-dots { display: flex; gap: 4px; }
        .dot { width: 4px; height: 4px; background: rgba(255,255,255,0.2); border-radius: 50%; }

        /* --- Synth Left --- */
        .image-display-container {
            flex: 1; background: #000;
            border-radius: 4px; overflow: hidden;
            position: relative;
            box-shadow: inset 0 0 50px rgba(0,0,0,0.8);
            min-height: 0;
        }
        #mainImage {
            width: 100%; height: 100%; object-fit: cover;
            opacity: 0.9; transition: opacity 0.5s ease;
            filter: grayscale(20%) contrast(1.1);
        }
        .overlay-info {
            position: absolute; bottom: 30px; left: 30px;
            z-index: 2; text-shadow: 0 2px 10px rgba(0,0,0,0.8);
        }
        .move-title-glitch {
            font-size: 42px; font-weight: 100; color: #fff; 
            line-height: 1; margin-bottom: 8px; letter-spacing: -1px;
            background: linear-gradient(to right, #fff, #a5f3fc);
            -webkit-background-clip: text; -webkit-text-fill-color: transparent;
        }
        .move-subtitle-tech { 
            font-size: 11px; color: var(--ethereal-cyan); letter-spacing: 4px; 
            text-transform: uppercase; border-left: 2px solid var(--ethereal-cyan); padding-left: 10px;
        }

        /* --- Synth Center --- */
        .info-content { flex: 1; display: flex; flex-direction: column; gap: 15px; height: 100%; min-height: 0; }
        .text-section { flex: 0 0 auto; }
        .context-box {
            font-family: 'Courier New', Courier, monospace;
            font-size: 11px; line-height: 1.5; color: rgba(255,255,255,0.8);
            background: rgba(255,255,255,0.02); padding: 12px; border-radius: 4px;
            border-left: 1px solid var(--ethereal-purple);
            white-space: pre-wrap;
        }
        .video-section { flex: 1; display: flex; flex-direction: column; min-height: 0; }
        .timbre-video-wrapper {
            flex: 1; width: 100%;
            border-radius: 4px; overflow: hidden;
            border: 1px solid rgba(255,255,255,0.1);
            position: relative; background: #000;
        }
        #timbreVideo {
            width: 100%; height: 100%; object-fit: cover;
            opacity: 0.6; transition: all 0.3s ease;
            filter: sepia(20%) hue-rotate(180deg) contrast(1.1);
        }
        .timbre-video-wrapper:hover #timbreVideo { opacity: 1; filter: none; }
        .hover-hint {
            position: absolute; bottom: 10px; right: 10px;
            background: rgba(0,0,0,0.6); color: var(--ethereal-cyan);
            font-size: 9px; padding: 4px 8px; border-radius: 4px;
            border: 1px solid var(--ethereal-cyan); pointer-events: none;
        }
        .scope-section { flex: 0 0 100px; }
        .visualizer-box {
            width: 100%; height: 100%;
            background: rgba(0,0,0,0.2); border-radius: 4px;
            border: 1px solid rgba(255,255,255,0.05);
        }

        /* --- Synth Right --- */
        .sequencer-grid {
            flex: 1; display: flex; flex-direction: column; gap: 6px;
            overflow-y: auto; padding-right: 5px; min-height: 0;
        }
        .track-card {
            display: flex; align-items: center; justify-content: space-between;
            padding: 12px; background: rgba(255,255,255,0.02);
            border: 1px solid transparent; border-radius: 6px;
            cursor: pointer; transition: all 0.3s;
        }
        .track-card:hover { background: rgba(255,255,255,0.05); transform: translateX(5px); }
        .track-card.selected {
            background: linear-gradient(90deg, rgba(165, 243, 252, 0.05), transparent);
            border-left: 2px solid var(--ethereal-cyan);
        }
        .track-title { font-size: 12px; font-weight: 500; color: #fff; }
        .track-type { font-size: 9px; color: var(--ethereal-purple); opacity: 0.7; }
        .neon-switch {
            width: 36px; height: 18px; background: rgba(0,0,0,0.5);
            border-radius: 20px; position: relative;
            border: 1px solid rgba(255,255,255,0.1); transition: 0.3s;
        }
        .neon-switch::after {
            content:''; position: absolute; left: 2px; top: 2px;
            width: 12px; height: 12px; border-radius: 50%;
            background: #555; transition: 0.3s;
        }
        .track-card.active .neon-switch { border-color: var(--ethereal-cyan); box-shadow: 0 0 8px var(--glow-color); }
        .track-card.active .neon-switch::after { left: 20px; background: var(--ethereal-cyan); }

        #play-bar-container {
            position: absolute; bottom: 0; left: 0; width: 100%; height: 3px;
            background: #111; z-index: 100;
        }
        #play-head {
            height: 100%; background: linear-gradient(90deg, var(--ethereal-purple), var(--ethereal-cyan));
            width: 0%; box-shadow: 0 -2px 10px var(--ethereal-cyan);
            transition: width 0.1s linear;
        }

        /* --- End Synth Module Styles --- */

        #outro-summary { position: relative; width: 100%; height: 100vh; background-color: #000000; display: flex; justify-content: center; align-items: center; z-index: 20; overflow: hidden; border-top: 1px solid #333; }
        #outro-canvas-container { position: absolute; top: 0; left: 0; width: 100%; height: 100%; z-index: 1; pointer-events: auto; }
        
        #outro-text {
            position: absolute; top: 15%; left: 50%; transform: translateX(-50%); width: 80%; max-width: 900px;
            text-align: center; font-family: 'Share Tech Mono', monospace; font-size: 1.1rem; line-height: 1.8;
            color: rgba(255, 255, 255, 0.9); text-shadow: 0 0 10px rgba(255,255,255,0.5); z-index: 100;
            pointer-events: none; opacity: 0; transition: opacity 1s;
        }
        #outro-text.visible { opacity: 1; }

        .nav-fixed { position: fixed; bottom: 30px; right: 40px; z-index: 100; mix-blend-mode: difference; }
        .nav-link { font-family: 'Syncopate'; font-size: 10px; color: #fff; cursor: pointer; }
    </style>
</head>
<body>
    <div class="film-grain"></div>
    
    <canvas id="wisp-canvas"></canvas>

    <div id="flash-overlay"></div>
    <div class="ambient-glow"></div>
    <canvas id="soul-tree-canvas"></canvas>

    <audio id="bgm" loop>
        <source src="audio/audiobgm.mp3" type="audio/mpeg">
    </audio>

    <div id="audio-toggle" onclick="toggleAudio()">
        <span class="eq-bar"></span><span class="eq-bar"></span><span class="eq-bar"></span>
        <span style="margin-left:5px">AUDIO</span>
    </div>

    <div id="start-screen">
        <div id="box-container" onclick="initializeSystem()"><span>INITIALIZE</span></div>
    </div>

    <div id="main-interface">
        <div class="tree-header">
            <h1 class="neon-title">ROOTED<br><span style="font-size:0.5em; color:#fff; -webkit-text-stroke:0;">/</span><br>LEVITATING</h1>
            <div class="header-monologue">
                <p>Departing from the roots of Wing Chun, pulsing with the rhythms of Hip-Hop, merging into the Pisces reverie.</p>
                <p>I once peered at the stage through a screen; now stepping out of physical confines, I explore the forms of unbound dance.</p>
            </div>
        </div>

        <div class="content-stream">
            <div class="intro-wide-block" id="intro-anchor">
                <div class="intro-img-box"><img src="images/image_e25b31.jpg" alt="Intro"></div>
            </div>

            <div class="section-divider">
                <div class="mini-door"></div>
                <h3 class="divider-text">ENTER MY CHILDHOOD: THE GOLDEN ERA 99-09</h3>
            </div>

            <section class="vine-section">
                <svg id="global-vine-svg">
                    <defs><linearGradient id="vineGradient" x1="0%" y1="0%" x2="100%" y2="0%"><stop offset="0%" stop-color="#ffae00" /><stop offset="100%" stop-color="#ff4500" /></linearGradient></defs>
                    <path id="vine-bg" class="vine-path-bg" /><path id="vine-main" class="vine-path-main" />
                </svg>
                
                <div class="node-block" id="node-1">
                    <div class="node-meta">
                        <h2 class="meta-title-bilingual">东方美学的国际化盛宴<small>The Global Feast of Eastern Aesthetics</small></h2>
                        <div class="meta-desc-bilingual">
                            <p>1999-2009年是中国武侠的国际化巅峰。以《卧虎藏龙》斩获奥斯卡为起点，武侠从港式江湖转向张艺谋《英雄》式的宏大美学与哲学思考。这十年见证了从写意剑戟到甄子丹《叶问》实战功夫的多元演变，让东方武学美学震撼全球。</p>
                            <span class="en-text">The years 1999-2009 marked the global pinnacle of Chinese Wuxia. Starting with Crouching Tiger, Hidden Dragon's Oscar win, the genre shifted from Hong Kong-style underworld tales to the grand visual aesthetics and philosophical depth of Zhang Yimou's Hero. This decade witnessed a diverse evolution from poetic swordplay to the grounded combat of Ip Man, introducing Eastern martial arts aesthetics to the world.</span>
                        </div>
                    </div>
                    <div class="node-visual">
                        <div class="cyber-screen" data-screen="1">
                            <div class="screen-overlay"></div>
                            <div class="slide active" style="background-image: url('images/poster_wc_1.jpg')"></div>
                            <div class="slide" style="background-image: url('images/poster_wc_2.jpg')"></div>
                            <div class="slide" style="background-image: url('images/poster_wc_3.jpg')"></div>
                            <div class="slide" style="background-image: url('images/poster_wc_4.jpg')"></div>
                        </div>
                    </div>
                </div>

                <div class="node-block" id="node-2">
                    <div class="node-meta">
                        <h2 class="meta-title-bilingual">街头梦想与MTV一代<small>Street Dreams & The MTV Generation</small></h2>
                        <div class="meta-desc-bilingual">
                            <p>这十年的嘻哈电影少了一份火药味，多了一份“星梦缘”。那是嘻哈全面接管流行文化的时期，电影主打“街头VS学院”的冲突美学。不仅是说唱，街舞（Breaking/Hip-Hop Dance）成为了年轻人表达自我的通用语言。那个时代的氛围是充满活力的、汗水淋漓的，每个人都相信只要在Battle中赢了，人生就能翻盘。</p>
                            <span class="en-text">This decade saw Hip-Hop movies shift from gritty crime tales to "stardom dreams." It was the era when Hip-Hop fully took over pop culture, and films focused on the aesthetic clash of "Street vs. Academy." Beyond just rap, street dance became the universal language of youth self-expression. The vibe was energetic and sweat-soaked, driven by the belief that winning a battle could change your life.</span>
                        </div>
                    </div>
                    <div class="node-visual">
                        <div class="cyber-screen" data-screen="2">
                            <div class="screen-overlay"></div>
                            <div class="slide active" style="background-image: url('images/poster_hh_1.jpg')"></div>
                            <div class="slide" style="background-image: url('images/poster_hh_2.jpg')"></div>
                            <div class="slide" style="background-image: url('images/poster_hh_3.jpg')"></div>
                        </div>
                    </div>
                </div>

                <div class="node-block" id="node-3">
                    <div class="node-meta">
                        <h2 class="meta-title-bilingual">世纪末的霓虹梦呓<small>Neon Daydreams at the Turn of the Century</small></h2>
                        <div class="meta-desc-bilingual">
                            <p>伴随千禧年的迷茫与科技躁动，神游舞曲（Trip-Hop）的迷幻节拍渗透进王家卫与侯孝贤的影像。从王菲《Di-Dar》的先锋实验到《千禧曼波》的霓虹疏离，这种文化捕捉了都市男女在世纪末的虚无与梦呓，构筑了独有的迷离美学。</p>
                            <span class="en-text">Amidst Y2K anxiety and technological restlessness, the psychedelic beats of Trip-Hop permeated the cinema of Wong Kar-wai and Hou Hsiao-hsien. From the avant-garde experiments of Faye Wong’s Di-Dar to the neon-lit alienation of Millennium Mambo, this culture captured the nihilism and dreamlike state of urban youth at the turn of the century, constructing a unique aesthetic of disorientation.</span>
                        </div>
                    </div>
                    <div class="node-visual">
                        <div class="cyber-screen" data-screen="3">
                            <div class="screen-overlay"></div>
                            <div class="slide active" style="background-image: url('images/poster_void_1.jpg')"></div>
                            <div class="slide" style="background-image: url('images/poster_void_2.jpg')"></div>
                            <div class="slide" style="background-image: url('images/poster_void_3.jpg')"></div>
                        </div>
                    </div>
                </div>
            </section>

            <div class="section-divider">
                <div class="mini-door"></div>
                <h3 class="divider-text">WHAT WILL I BECOME?</h3>
            </div>

             <!-- NEW GRAFFITI WALL SECTION -->
            <section id="graffiti-wall-section">
                
                <!-- The Void Terminal -->
                <div class="void-terminal">
                    
                    <!-- HUD Elements (Viewfinder) -->
                    <div class="hud-corner tl"></div>
                    <div class="hud-corner tr"></div>
                    <div class="hud-corner bl"></div>
                    <div class="hud-corner br"></div>
                    
                    <div class="hud-status">
                        <div class="hud-rec"><div class="hud-dot"></div> MEMORY_STREAM</div>
                        <div>ISO 800 // F2.8</div>
                    </div>

                    <!-- Header Controls (Floating) -->
                    <div class="gw-header">
                        <div class="gw-btn-icon" onclick="graffitiApp.togglePlay()" title="Play/Pause">
                            <svg id="gw-play-icon" class="gw-icon-svg" viewBox="0 0 24 24" style="stroke:currentColor;"><rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/></svg>
                        </div>
                        <div class="gw-btn-icon" onclick="graffitiApp.saveArt()" title="Save Art">
                            <svg class="gw-icon-svg" viewBox="0 0 24 24" style="stroke:currentColor;"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        </div>
                        <div class="gw-btn-icon danger" onclick="graffitiApp.clearTank()" title="Clear">
                            <svg class="gw-icon-svg" viewBox="0 0 24 24" style="stroke:currentColor;"><polyline points="3 6 5 6 21 6"/><path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"/></svg>
                        </div>
                    </div>

                    <!-- Canvas Layers -->
                    <canvas id="gw-canvas-trail"></canvas>
                    <div id="gw-objects-container"></div>
                    
                    <!-- Bottom Inputs Overlay -->
                    <div class="gw-dock-wrapper">
                        <div class="gw-dock">
                            <!-- INK -->
                            <div class="gw-prism-btn ink" onclick="document.getElementById('gw-ink-input').click()" title="INK MODE">
                                <svg class="gw-icon-svg" viewBox="0 0 24 24"><path d="M20.24 12.24a6 6 0 0 0-8.49-8.49L5 10.5V19h8.5z"/><line x1="16" y1="8" x2="2" y2="22"/><line x1="17.5" y1="15" x2="9" y2="15"/></svg>
                                <input type="file" id="gw-ink-input" hidden accept="image/*" onchange="graffitiApp.handleUpload(event, 'ink')">
                            </div>
                            <!-- HIPHOP -->
                            <div class="gw-prism-btn hiphop" onclick="document.getElementById('gw-hiphop-input').click()" title="POP MODE">
                                <svg class="gw-icon-svg" viewBox="0 0 24 24"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>
                                <input type="file" id="gw-hiphop-input" hidden accept="image/*" onchange="graffitiApp.handleUpload(event, 'hiphop')">
                            </div>
                            <!-- ACID -->
                            <div class="gw-prism-btn acid" onclick="document.getElementById('gw-acid-input').click()" title="ACID MODE">
                                <svg class="gw-icon-svg" viewBox="0 0 24 24"><path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/></svg>
                                <input type="file" id="gw-acid-input" hidden accept="image/*" onchange="graffitiApp.handleUpload(event, 'acid')">
                            </div>
                        </div>
                        <div class="upload-text">Upload Your Memory</div>
                    </div>

                </div>
            </section>

            <!-- NEW DIVIDER: TRANSITION TO STAGE -->
            <div class="section-divider">
                <div class="mini-door"></div>
                <h3 class="divider-text">PLEASE STEP ON STAGE</h3>
            </div>
        </div>

        <section id="hologram-stage">
            <div class="scan-line"></div>
            <div id="three-container"></div>
            <div class="holo-ui">
                <div style="position:absolute; top:40px; left:50%; transform:translateX(-50%); text-align:center; color:#fff;">
                    <h3 style="font-family:'Orbitron'; letter-spacing:5px; margin:0;">WING CHUN DATA</h3>
                    <span style="font-family:'Syncopate'; font-size:10px; color:#ff4500;">MOTION CAPTURE</span>
                </div>
            </div>
        </section>

        <section id="synth-section">
            <!-- 1. Background System -->
            <div class="ethereal-blob blob-gold"></div>
            <div class="ethereal-blob blob-orange"></div>
            <div class="ethereal-noise"></div>
            <div class="play-progress"><div id="play-head"></div></div>

            <!-- 2. Main Grid Layout -->
            <div class="synth-layout">
                
                <!-- Top Bar -->
                <div class="synth-top">
                    <div class="synth-brand">
                        <h2>SYNTHESIS</h2>
                        <span>MOTION TO SOUND INTERFACE</span>
                    </div>
                    <div class="synth-controls">
                        <button class="glass-btn" onclick="synthApp.toggleAll(true)">UNMUTE ALL</button>
                        <button class="glass-btn" id="playBtn" onclick="synthApp.togglePlay()">INITIALIZE</button>
                    </div>
                </div>

                <!-- Left Panel: Visualizer (Expanded) -->
                <div class="glass-panel" style="grid-row: 2 / 3;">
                    <div class="panel-title">VISUAL FEED</div>
                    <div class="vis-container">
                        <img id="mainImage" src="" alt="Move">
                        <div class="vis-overlay">
                            <div class="vis-text-lg" id="displayTitle">TAN SAO</div>
                            <div class="vis-text-sm" id="displaySubtitle">AMBIENT PAD</div>
                        </div>
                    </div>
                </div>

                <!-- Center Panel: Data & Scope (Compressed) -->
                <div class="glass-panel" style="grid-row: 2 / 3;">
                    <div class="panel-title">DATA STREAM</div>
                    <div class="info-stack">
                        <div class="desc-box" id="displayText">
                            System Standby...
                        </div>
                        
                        <div class="mini-video">
                            <video id="timbreVideo" loop muted playsinline></video>
                            <div style="position:absolute; bottom:5px; right:5px; font-size:8px; color:rgba(255,174,0,0.8); font-family:'Share Tech Mono'">HOVER TO LISTEN</div>
                        </div>

                        <div>
                            <div class="panel-title" style="margin-bottom:8px; font-size:8px;">OSCILLOSCOPE</div>
                            <canvas id="scopeCanvas" class="scope-box" width="300" height="140"></canvas>
                        </div>
                    </div>
                </div>

                <!-- Right Panel: Sequencer -->
                <div class="glass-panel" style="grid-row: 2 / 3;">
                    <div class="panel-title">SEQUENCE LAYER</div>
                    <div class="seq-list" id="trackList">
                        <!-- JS Generated Items -->
                    </div>
                </div>

            </div>
        </section>

        <!-- NEW BLANK PAGE FOR FUTURE CONTENT -->
        <section id="blank-void-section">
            <div class="void-placeholder-text">[ VOID SPACE RESERVED ]</div>
        </section>

        <section id="outro-summary">
            <div id="outro-text"></div>
            <div id="outro-canvas-container"></div>
        </section>
        
        <div class="nav-fixed"><div class="nav-link" onclick="location.reload()">RESTART</div></div>
        
        <div class="credits-fixed">WEBPAGE GENERATED WITH GEMINI</div>
    </div>

    <script>
        // --- 0. Audio Manager (Main Page) ---
        let bgmPlaying = false;
        function toggleAudio() {
            const bgm = document.getElementById('bgm');
            const btn = document.getElementById('audio-toggle');
            if(bgm.paused) {
                bgm.play().then(() => {
                    bgmPlaying = true;
                    btn.classList.remove('muted');
                }).catch(e => console.log("Audio waiting for user interaction"));
            } else {
                bgm.pause();
                bgmPlaying = false;
                btn.classList.add('muted');
            }
        }

        // --- 1. Digital Wisp (Mouse Follower) ---
        function initWisp() {
            const canvas = document.getElementById('wisp-canvas');
            const ctx = canvas.getContext('2d');
            let w, h;
            let mx = -100, my = -100; // Mouse coords
            let tx = -100, ty = -100; // Trail coords (lerped)
            const history = [];

            const resize = () => { w = canvas.width = window.innerWidth; h = canvas.height = window.innerHeight; };
            window.addEventListener('resize', resize);
            window.addEventListener('mousemove', e => { mx = e.clientX; my = e.clientY; });
            resize();

            // Set initial position
            mx = w/2; my = h/2; tx = mx; ty = my;

            function animateWisp() {
                ctx.clearRect(0, 0, w, h);
                
                // Lerp for smooth following
                tx += (mx - tx) * 0.08;
                ty += (my - ty) * 0.08;

                // Add slight sine wave hover if static
                const time = Date.now() * 0.002;
                const hoverY = Math.sin(time) * 5;

                // History trail
                history.push({x: tx, y: ty + hoverY});
                if(history.length > 20) history.shift();

                // Draw trail
                ctx.beginPath();
                for(let i=0; i<history.length; i++) {
                    const p = history[i];
                    if(i===0) ctx.moveTo(p.x, p.y);
                    else ctx.lineTo(p.x, p.y);
                }
                ctx.strokeStyle = `rgba(255, 174, 0, 0.3)`;
                ctx.lineWidth = 2;
                ctx.lineCap = 'round';
                ctx.stroke();

                // Draw Core
                const grad = ctx.createRadialGradient(tx, ty + hoverY, 0, tx, ty + hoverY, 15);
                grad.addColorStop(0, 'rgba(255, 255, 255, 1)');
                grad.addColorStop(0.4, 'rgba(255, 174, 0, 0.8)');
                grad.addColorStop(1, 'rgba(255, 174, 0, 0)');
                ctx.fillStyle = grad;
                ctx.beginPath();
                ctx.arc(tx, ty + hoverY, 15, 0, Math.PI*2);
                ctx.fill();

                requestAnimationFrame(animateWisp);
            }
            animateWisp();
        }

        // --- System Initialization ---
        function initializeSystem() {
            document.getElementById('start-screen').classList.add('hidden');
            document.body.classList.add('flashing');
            
            // Try to play BGM on start
            const bgm = document.getElementById('bgm');
            bgm.volume = 0.2; 
            
            bgm.play().then(() => {
                bgmPlaying = true;
            }).catch(e => {
                console.log("Audio blocked, use toggle");
                document.getElementById('audio-toggle').classList.add('muted');
            });

            setTimeout(() => {
                document.body.classList.remove('flashing');
                document.body.classList.add('active');
                updateVine();
                initSlideshows(); 
                initWisp(); // Start the wisp
                graffitiApp.init(); // Init new graffiti wall
            }, 100);
        }

        // --- Slideshows ---
        function initSlideshows() {
            const screens = document.querySelectorAll('.cyber-screen');
            screens.forEach((screen, index) => {
                const slides = screen.querySelectorAll('.slide');
                let currentIdx = 0;
                const intervalTime = 3500 + Math.random() * 2000;
                setInterval(() => {
                    slides[currentIdx].classList.remove('active');
                    currentIdx = (currentIdx + 1) % slides.length;
                    slides[currentIdx].classList.add('active');
                }, intervalTime);
            });
        }

        // --- Background Soul Tree ---
        const soulCanvas = document.getElementById('soul-tree-canvas'); const soulCtx = soulCanvas.getContext('2d');
        let soulW, soulH; const tentacles = []; const numTentacles = 100; const spiritParticles = []; 
        function resizeTree() { soulW = soulCanvas.width = window.innerWidth; soulH = soulCanvas.height = window.innerHeight; initTentacles(); updateVine(); }
        window.addEventListener('resize', resizeTree);
        class Tentacle { constructor() { this.reset(); } reset() { this.x = soulW / 2 + (Math.random() - 0.5) * soulW * 0.6; this.y = soulH + Math.random() * 100; this.segments = []; this.numSegments = 60; this.segHeight = (soulH + 250) / this.numSegments; this.angleOffset = Math.random() * Math.PI * 2; this.waveSpeed = Math.random() * 0.015 + 0.005; this.colorBase = Math.random() > 0.5 ? '255, 174, 0' : '255, 69, 0'; this.thickness = Math.random() * 1.8 + 0.3; for(let i=0; i<this.numSegments; i++) { this.segments.push({ x: this.x, y: this.y - i * this.segHeight }); } } update(time) { for(let i=0; i<this.numSegments; i++) { const sway = Math.sin(time * this.waveSpeed + i * 0.08 + this.angleOffset) * (i * 0.6); this.segments[i].x = this.x + sway + (this.x - soulW/2) * (i/this.numSegments) * 0.8; } } draw() { soulCtx.beginPath(); soulCtx.moveTo(this.segments[0].x, this.segments[0].y); for(let i=1; i<this.numSegments - 1; i++) { const xc = (this.segments[i].x + this.segments[i+1].x) / 2; const yc = (this.segments[i].y + this.segments[i+1].y) / 2; soulCtx.quadraticCurveTo(this.segments[i].x, this.segments[i].y, xc, yc); } const gradient = soulCtx.createLinearGradient(this.x, soulH, this.x, 0); gradient.addColorStop(0, `rgba(${this.colorBase}, 0)`); gradient.addColorStop(0.3, `rgba(${this.colorBase}, 0.5)`); gradient.addColorStop(1, `rgba(${this.colorBase}, 0)`); soulCtx.strokeStyle = gradient; soulCtx.lineWidth = this.thickness; soulCtx.stroke(); } }
        class Spirit { constructor() { this.reset(); } reset() { this.x = Math.random() * soulW; this.y = soulH + Math.random() * 100; this.vy = Math.random() * 0.8 + 0.2; this.size = Math.random() * 1.5; this.alpha = Math.random(); } update() { this.y -= this.vy; if(this.y < 0) this.reset(); } draw() { soulCtx.fillStyle = `rgba(255, 200, 100, ${this.alpha * 0.4})`; soulCtx.beginPath(); soulCtx.arc(this.x, this.y, this.size, 0, Math.PI*2); soulCtx.fill(); } }
        function initTentacles() { tentacles.length = 0; spiritParticles.length = 0; for(let i=0; i<numTentacles; i++) tentacles.push(new Tentacle()); for(let i=0; i<60; i++) spiritParticles.push(new Spirit()); }
        let globalTime = 0; function animateTree() { soulCtx.fillStyle = 'rgba(10, 5, 0, 0.1)'; soulCtx.fillRect(0, 0, soulW, soulH); soulCtx.globalCompositeOperation = 'lighter'; globalTime += 1; tentacles.forEach(t => { t.update(globalTime); t.draw(); }); spiritParticles.forEach(s => { s.update(); s.draw(); }); soulCtx.globalCompositeOperation = 'source-over'; requestAnimationFrame(animateTree); }
        resizeTree(); animateTree();

        // --- 2. Vine Navigation ---
        function updateVine() {
            const container = document.querySelector('.vine-section'); const intro = document.getElementById('intro-anchor');
            const n1 = document.getElementById('node-1'); const n2 = document.getElementById('node-2'); const n3 = document.getElementById('node-3');
            if(!intro || !n1 || !n2 || !n3) return;
            const getCenter = (el) => { const r = el.getBoundingClientRect(); const c = container.getBoundingClientRect(); return { x: r.left + r.width/2 - c.left, y: r.top + r.height/2 - c.top }; };
            const p0 = { x: container.offsetWidth/2, y: intro.offsetTop + intro.offsetHeight }; const p1 = getCenter(n1); const p2 = getCenter(n2); const p3 = getCenter(n3);
            const pathData = `M ${p0.x} ${p0.y} C ${p0.x} ${p0.y+150}, ${p1.x} ${p1.y-150}, ${p1.x} ${p1.y} S ${p2.x} ${p2.y-150}, ${p2.x} ${p2.y} S ${p3.x} ${p3.y-150}, ${p3.x} ${p3.y} L ${container.offsetWidth/2} ${container.offsetHeight}`;
            document.getElementById('vine-bg').setAttribute('d', pathData); const vm = document.getElementById('vine-main'); vm.setAttribute('d', pathData);
            const len = vm.getTotalLength(); vm.style.strokeDasharray = len;
            document.getElementById('main-interface').addEventListener('scroll', (e) => {
                const pct = e.target.scrollTop / (e.target.scrollHeight - window.innerHeight);
                vm.style.strokeDashoffset = len - len * Math.min(pct * 2, 1);
            });
        }
        const observer = new IntersectionObserver((e)=>{e.forEach(i=>{
            if(i.isIntersecting) {
                i.target.classList.add('is-visible');
            }
        })}, {threshold:0.3});
        document.querySelectorAll('.node-block, .section-divider').forEach(b=>observer.observe(b));

        // ==========================================
        // --- GRAFFITI WALL LOGIC (NEW) ---
        // ==========================================
        const graffitiApp = {
            images: [],
            isRunning: true,
            canvas: null,
            ctx: null,
            container: null,
            time: 0,
            frameId: null,
            observer: null,

            init: () => {
                graffitiApp.canvas = document.getElementById('gw-canvas-trail');
                graffitiApp.ctx = graffitiApp.canvas.getContext('2d');
                graffitiApp.container = document.getElementById('gw-objects-container');
                
                // Set preset images (Ensure these files exist in images/graffiti_presets/)
                const initialData = [
                    // Original 3
                    { id: 'gw-init-1', type: 'ink', src: 'images/graffiti_presets/preset_ink.png', x: 150, y: 150 },
                    { id: 'gw-init-2', type: 'hiphop', src: 'images/graffiti_presets/preset_hiphop.png', x: 400, y: 300 },
                    { id: 'gw-init-3', type: 'acid', src: 'images/graffiti_presets/preset_acid.png', x: 600, y: 200 },
                    // New 3 (Added as requested)
                    { id: 'gw-init-4', type: 'ink', src: 'images/graffiti_presets/preset_ink_2.png', x: 250, y: 450 },
                    { id: 'gw-init-5', type: 'hiphop', src: 'images/graffiti_presets/preset_hiphop_2.png', x: 550, y: 100 },
                    { id: 'gw-init-6', type: 'acid', src: 'images/graffiti_presets/preset_acid_2.png', x: 750, y: 350 }
                ];

                // Fallback if local images missing, use placeholders for functionality demonstration
                initialData.forEach(d => {
                    const img = new Image();
                    img.src = d.src;
                    img.onerror = () => { 
                         // Fallback to Unsplash if local file is missing
                         if(d.type === 'ink') d.src = 'https://images.unsplash.com/photo-1517486430290-35657afd05cb?w=400&q=80';
                         if(d.type === 'hiphop') d.src = 'https://images.unsplash.com/photo-1549887534-1541e9326642?w=400&q=80';
                         if(d.type === 'acid') d.src = 'https://images.unsplash.com/photo-1550684848-fac1c5b4e853?w=400&q=80';
                         graffitiApp.updateDOM(d); // Refresh DOM
                    };
                });

                graffitiApp.images = initialData.map(d => ({
                    ...d,
                    vx: (Math.random() - 0.5) * 1.0, 
                    vy: (Math.random() - 0.5) * 1.0,
                    rotation: Math.random() * 360,
                    rotSpeed: (Math.random() - 0.5) * 0.3,
                    buoyancyOffset: Math.random() * 100
                }));

                graffitiApp.images.forEach(img => graffitiApp.createDOM(img));
                
                // Resize handling
                const resize = () => {
                    const rect = graffitiApp.container.parentElement.getBoundingClientRect();
                    graffitiApp.canvas.width = rect.width;
                    graffitiApp.canvas.height = rect.height;
                };
                window.addEventListener('resize', resize);
                resize();

                // Visibility observer to pause/resume loop
                const section = document.getElementById('graffiti-wall-section');
                graffitiApp.observer = new IntersectionObserver((entries) => {
                    entries.forEach(entry => {
                        if (entry.isIntersecting) {
                            if (!graffitiApp.frameId && graffitiApp.isRunning) graffitiApp.loop();
                        } else {
                            if (graffitiApp.frameId) {
                                cancelAnimationFrame(graffitiApp.frameId);
                                graffitiApp.frameId = null;
                            }
                        }
                    });
                });
                graffitiApp.observer.observe(section);

                graffitiApp.loop();
            },

            createDOM: (obj) => {
                const div = document.createElement('div');
                div.id = `organism-${obj.id}`;
                div.className = 'gw-organism';
                const divInner = document.createElement('div');
                divInner.className = 'gw-organism-inner';
                const img = document.createElement('img');
                img.src = obj.src;
                img.draggable = false;
                divInner.appendChild(img);
                div.appendChild(divInner);
                graffitiApp.container.appendChild(div);
            },
            
            updateDOM: (obj) => {
                // If fallback changes src, update image tag
                const el = document.getElementById(`organism-${obj.id}`);
                if(el) el.querySelector('img').src = obj.src;
            },

            handleUpload: (e, type) => {
                const files = Array.from(e.target.files);
                if (!files.length) return;
                const rect = graffitiApp.container.getBoundingClientRect();

                files.forEach(file => {
                    const reader = new FileReader();
                    reader.onload = (ev) => {
                        const id = 'gw-' + Date.now() + Math.random();
                        const newObj = {
                            id, type,
                            src: ev.target.result,
                            x: rect.width / 2,
                            y: rect.height / 2,
                            vx: (Math.random() - 0.5) * 1.5,
                            vy: (Math.random() - 0.5) * 1.5,
                            rotation: Math.random() * 360,
                            rotSpeed: (Math.random() - 0.5) * 0.3,
                            buoyancyOffset: Math.random() * 100
                        };
                        graffitiApp.images.push(newObj);
                        graffitiApp.createDOM(newObj);
                    };
                    reader.readAsDataURL(file);
                });
                e.target.value = '';
            },

            loop: () => {
                if (!graffitiApp.isRunning) {
                    graffitiApp.frameId = requestAnimationFrame(graffitiApp.loop);
                    return;
                }

                const rect = graffitiApp.canvas.getBoundingClientRect();
                const width = rect.width;
                const height = rect.height;
                graffitiApp.time += 0.008;

                graffitiApp.images.forEach(obj => {
                    const prevX = obj.x;
                    const prevY = obj.y;

                    // Physics
                    obj.x += obj.vx;
                    obj.y += obj.vy;
                    
                    // Buoyancy
                    const floatY = Math.sin(graffitiApp.time + obj.buoyancyOffset) * 0.3 + 
                                   Math.cos(graffitiApp.time * 0.5 + obj.buoyancyOffset) * 0.1;
                    obj.y += floatY;
                    
                    obj.rotation += obj.rotSpeed;

                    // Boundaries
                    const padding = 50;
                    if (obj.x <= padding || obj.x >= width - padding) {
                        obj.vx *= -1;
                        obj.x = obj.x <= padding ? padding + 1 : width - padding - 1;
                        obj.rotSpeed += (Math.random() - 0.5) * 0.1;
                    }
                    if (obj.y <= padding || obj.y >= height - padding) {
                        obj.vy *= -1;
                        obj.y = obj.y <= padding ? padding + 1 : height - padding - 1;
                        obj.rotSpeed += (Math.random() - 0.5) * 0.1;
                    }
                    obj.rotSpeed = Math.max(Math.min(obj.rotSpeed, 0.8), -0.8);

                    // Draw
                    graffitiApp.drawTrail(prevX, prevY, obj.x, obj.y, obj.type, obj.vx, obj.vy);

                    // Update DOM
                    const el = document.getElementById(`organism-${obj.id}`);
                    if (el) {
                        const tiltX = obj.vy * 8; 
                        const tiltY = -obj.vx * 8;
                        const breath = 1 + Math.sin(graffitiApp.time * 2 + obj.buoyancyOffset) * 0.02;
                        el.style.transform = `translate(${obj.x - 50}px, ${obj.y - 50}px) rotate(${obj.rotation}deg) rotateX(${tiltX}deg) rotateY(${tiltY}deg) scale(${breath})`;
                    }
                });

                graffitiApp.frameId = requestAnimationFrame(graffitiApp.loop);
            },

            drawTrail: (x1, y1, x2, y2, type, vx, vy) => {
                const ctx = graffitiApp.ctx;
                ctx.lineCap = 'round';
                ctx.lineJoin = 'round';
                const speed = Math.hypot(vx, vy);

                ctx.save();
                if (type === 'ink') {
                    // INK ON DARK: White/Grey Smoke effect instead of black
                    ctx.globalCompositeOperation = 'source-over'; 
                    // Use a very light grey with low opacity for smoke
                    ctx.strokeStyle = `rgba(220, 220, 230, ${Math.max(0.05, 0.2 - speed * 0.1)})`;
                    ctx.lineWidth = Math.max(2, 25 - speed * 5);
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = 'rgba(255, 255, 255, 0.2)'; // Faint white glow
                    ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
                } else if (type === 'hiphop') {
                    // HIPHOP ON DARK: Neon Graffiti
                    const hue = (Date.now() / 40) % 360;
                    ctx.globalCompositeOperation = 'screen'; // Screen mode makes colors pop on dark
                    ctx.strokeStyle = `hsla(${hue}, 100%, 60%, 0.6)`;
                    ctx.lineWidth = 15;
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = `hsla(${hue}, 100%, 50%, 0.8)`;
                    ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
                } else if (type === 'acid') {
                    // ACID ON DARK: Laser Beams
                    ctx.globalCompositeOperation = 'lighter'; // Additive blending for max brightness
                    ctx.strokeStyle = 'rgba(0, 255, 204, 0.5)'; // Cyber Cyan
                    ctx.lineWidth = 4;
                    ctx.shadowBlur = 10;
                    ctx.shadowColor = '#00ffcc';
                    ctx.beginPath(); ctx.moveTo(x1, y1); ctx.lineTo(x2, y2); ctx.stroke();
                    // Sparkles
                    if (Math.random() > 0.92) {
                        ctx.fillStyle = '#fff';
                        ctx.beginPath();
                        ctx.arc(x2 + (Math.random()-0.5)*30, y2 + (Math.random()-0.5)*30, Math.random()*2, 0, Math.PI*2);
                        ctx.fill();
                    }
                }
                ctx.restore();
            },

            togglePlay: () => {
                graffitiApp.isRunning = !graffitiApp.isRunning;
                const icon = document.getElementById('gw-play-icon');
                if(!graffitiApp.isRunning) {
                   // Change to Play Icon
                   icon.innerHTML = '<polygon points="5 3 19 12 5 21 5 3"></polygon>';
                } else {
                   // Change to Pause Icon
                   icon.innerHTML = '<rect x="6" y="4" width="4" height="16"/><rect x="14" y="4" width="4" height="16"/>';
                   if (!graffitiApp.frameId) graffitiApp.loop();
                }
            },

            clearTank: () => {
                graffitiApp.images = [];
                graffitiApp.container.innerHTML = '';
                graffitiApp.ctx.clearRect(0, 0, graffitiApp.canvas.width, graffitiApp.canvas.height);
            },

            saveArt: () => {
                const finalCanvas = document.createElement('canvas');
                finalCanvas.width = graffitiApp.canvas.width;
                finalCanvas.height = graffitiApp.canvas.height;
                const ctx = finalCanvas.getContext('2d');
                
                // Draw DARK background for save
                const grd = ctx.createLinearGradient(0, 0, 0, finalCanvas.height);
                grd.addColorStop(0, "#050505"); grd.addColorStop(1, "#1a1005");
                ctx.fillStyle = grd; ctx.fillRect(0, 0, finalCanvas.width, finalCanvas.height);
                
                // Draw trails (Light on Dark)
                ctx.drawImage(graffitiApp.canvas, 0, 0);
                
                // Draw objects
                graffitiApp.images.forEach(obj => {
                    const el = document.getElementById(`organism-${obj.id}`);
                    if(el) {
                        const img = el.querySelector('img');
                        if(img.complete && img.naturalWidth !== 0) {
                            ctx.save();
                            ctx.translate(obj.x, obj.y);
                            ctx.rotate(obj.rotation * Math.PI / 180);
                            try { ctx.drawImage(img, -50, -50, 100, 100); } catch(e){}
                            ctx.restore();
                        }
                    }
                });

                const link = document.createElement('a');
                link.download = `PhotoGraffiti_${Date.now()}.png`;
                link.href = finalCanvas.toDataURL();
                link.click();
            }
        };

        // --- 3. Hologram Stage ---
        (function() {
            const container = document.getElementById('three-container'); const scene = new THREE.Scene();
            // ... (Rest of Three.js code remains same) ...
            const camera = new THREE.PerspectiveCamera(60, window.innerWidth / (window.innerHeight * 0.9), 0.1, 1000); camera.position.z = 120; camera.position.y = 10;
            const renderer = new THREE.WebGLRenderer({ alpha: true, antialias: true }); renderer.setSize(window.innerWidth, window.innerHeight * 0.9); container.appendChild(renderer.domElement);
            const video = document.createElement('video'); video.src = 'images/wingchun.mp4'; video.loop = true; video.muted = true; video.play().catch(e=>console.log("Video not found, using noise fallback")); video.setAttribute('playsinline', '');
            const texture = new THREE.VideoTexture(video); texture.minFilter = THREE.LinearFilter;
            const densityX = 400; const densityY = 200; const particleCount = densityX * densityY;
            const geometry = new THREE.BufferGeometry(); const positions = new Float32Array(particleCount * 3); const uvs = new Float32Array(particleCount * 2);
            let index = 0; const width = 180; const height = 100;
            for (let y = 0; y < densityY; y++) { for (let x = 0; x < densityX; x++) { uvs[index * 2] = x / (densityX - 1); uvs[index * 2 + 1] = y / (densityY - 1); const xPos = (x / (densityX - 1) - 0.5) * width; const yPos = (y / (densityY - 1) - 0.5) * height; positions[index * 3] = xPos; positions[index * 3 + 1] = yPos; positions[index * 3 + 2] = 0; index++; } }
            geometry.setAttribute('position', new THREE.BufferAttribute(positions, 3)); geometry.setAttribute('uv', new THREE.BufferAttribute(uvs, 2));
            const mat = new THREE.ShaderMaterial({
                uniforms: { t: { value: texture }, time: { value: 0 }, colHigh: { value: new THREE.Color(0xffffff) }, colLow: { value: new THREE.Color(0xff4500) } },
                vertexShader: `uniform sampler2D t; varying vec2 vUv; varying float vVis; void main() { vUv = uv; vec4 c = texture2D(t, uv); float b = (c.r + c.g + c.b) / 3.0; if(b < 0.1) b = sin(uv.x*10.0+uv.y*10.0)*0.1; vVis = smoothstep(0.05, 0.4, b); vec3 p = position; p.z += b * 40.0 * vVis; gl_Position = projectionMatrix * modelViewMatrix * vec4(p, 1.0); gl_PointSize = (2.0 * vVis + 0.1); }`,
                fragmentShader: `uniform vec3 colHigh; uniform vec3 colLow; uniform float time; varying float vVis; varying vec2 vUv; void main() { if (vVis < 0.1) discard; vec3 finalCol = mix(colLow, colHigh, smoothstep(0.4, 0.7, vVis)); float scan = sin(vUv.y * 5.0 - time * 3.0); if(scan > 0.95) finalCol = vec3(1.0); gl_FragColor = vec4(finalCol, vVis * 0.9); }`,
                transparent: true, blending: THREE.AdditiveBlending, depthWrite: false
            });
            const particles = new THREE.Points(geometry, mat); scene.add(particles);
            function animate() { requestAnimationFrame(animate); mat.uniforms.time.value += 0.02; renderer.render(scene, camera); }
            animate();
        })();
        
        // ... (Rest of Audio Engine, Synth App, and Outro code remains same) ...
        // ... (Appending JS code for brevity in display, full file has all logic) ...
        // I will finish the rest of the JS logic below to ensure the file works completely.

        // ==========================================
        // 4. SYNTH MODULE LOGIC (Existing)
        // ==========================================
        const ASSETS = [
            { id: 0, move: "Center Line Reset (回正)", inst: "Ambient Pad", desc: "MEANING: Reset pose between movements.\nPHILOSOPHY: Never deviate from the center line; maintain balance.\nTECHNIQUE: Hands guarding chest naturally; center of gravity grounded.", imageSrc: "assets/move_01_tansao.jpg", timbreVideoSrc: "assets/timbre_01_pad.mp4", active: true },
            { id: 1, move: "Chi Sau (黐手)", inst: "Acid 303 Bass", desc: "MEANING: Training arm sensitivity and flow.\nTECHNIQUE: Hands sticking together, sensing and redirecting force like flowing mercury.", imageSrc: "assets/move_02_bongsao.jpg", timbreVideoSrc: "assets/timbre_02_acid.mp4", active: false },
            { id: 2, move: "Bong Sau (膀手)", inst: "BoomBap Snare", desc: "MEANING: Wing arm technique to deflect attacks.\nTECHNIQUE: Elbow raised, rotating forearm outward to divert force using leverage.", imageSrc: "assets/move_03_paksao.jpg", timbreVideoSrc: "assets/timbre_03_snare.mp4", active: false },
            { id: 3, move: "Chit Jeung (切掌)", inst: "Rolling Hi-Hats", desc: "MEANING: Continuous straight-line chopping attacks.\nAUDIO SYNC: Corresponds to rolling Hi-Hats in Trap music, building tension.", imageSrc: "assets/move_04_punch.jpg", timbreVideoSrc: "assets/timbre_04_hihat.mp4", active: false },
            { id: 4, move: "Saam Sing Kuen (三星拳)", inst: "808 Sub Bass", desc: "MEANING: Diagonal chopping strikes to break defense.\nTECHNIQUE: Power generated from waist and legs, delivering heavy, penetrating strikes.", imageSrc: "assets/move_05_fooksao.jpg", timbreVideoSrc: "assets/timbre_05_sub.mp4", active: false },
            { id: 5, move: "Outside Crescent Kick (外摆踢)", inst: "Pluck Synth", desc: "MEANING: Outward arcing leg sweep to disturb balance.\nTECHNIQUE: Fluid arc motion from inside out, utilizing the toe or instep.", imageSrc: "assets/move_06_gumsao.jpg", timbreVideoSrc: "assets/timbre_06_kick.mp4", active: false },
            { id: 6, move: "Side Kick (侧踢腿)", inst: "Heavy Kick", desc: "MEANING: Lateral thrust kick to control distance.\nTECHNIQUE: Stable support leg; heel thrusts out horizontally. Rhythm skeleton.", imageSrc: "assets/move_07_biujee.jpg", timbreVideoSrc: "assets/timbre_07_lead.mp4", active: true }
        ];

        class AudioEngine {
            constructor() {
                this.ctx = new (window.AudioContext || window.webkitAudioContext)();
                this.masterGain = this.ctx.createGain();
                this.masterGain.gain.value = 0.5;
                this.masterGain.connect(this.ctx.destination);
                
                this.analyser = this.ctx.createAnalyser();
                this.analyser.fftSize = 2048;
                this.masterGain.connect(this.analyser);

                this.reverb = this.ctx.createConvolver();
                this.generateReverb();
                this.reverbGain = this.ctx.createGain();
                this.reverbGain.gain.value = 0.3;
                this.reverb.connect(this.reverbGain);
                this.reverbGain.connect(this.masterGain);

                this.tempo = 120;
                this.isPlaying = false;
                this.timerID = null;
            }

            resume() { if(this.ctx.state === 'suspended') this.ctx.resume(); }

            generateReverb() {
                const rate = this.ctx.sampleRate;
                const length = rate * 2;
                const impulse = this.ctx.createBuffer(2, length, rate);
                for(let i=0; i<2; i++) {
                    const ch = impulse.getChannelData(i);
                    for(let j=0; j<length; j++) ch[j] = (Math.random()*2-1) * Math.pow(1-j/length, 2);
                }
                this.reverb.buffer = impulse;
            }

            playTone(freq, type, time, dur, vol) {
                const osc = this.ctx.createOscillator();
                const gain = this.ctx.createGain();
                osc.type = type;
                osc.frequency.setValueAtTime(freq, time);
                gain.gain.setValueAtTime(vol, time);
                gain.gain.exponentialRampToValueAtTime(0.001, time + dur);
                
                osc.connect(gain);
                gain.connect(this.masterGain);
                gain.connect(this.reverb);
                osc.start(time);
                osc.stop(time + dur);
            }

            playKick(t) {
                const osc = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                osc.frequency.setValueAtTime(150, t);
                osc.frequency.exponentialRampToValueAtTime(0.01, t + 0.5);
                g.gain.setValueAtTime(0.8, t);
                g.gain.exponentialRampToValueAtTime(0.01, t + 0.5);
                osc.connect(g); g.connect(this.masterGain);
                osc.start(t); osc.stop(t + 0.5);
            }

            playSnare(t) {
                const b = this.ctx.createBuffer(1, this.ctx.sampleRate*0.1, this.ctx.sampleRate);
                const d = b.getChannelData(0);
                for(let i=0; i<d.length; i++) d[i] = Math.random()*2-1;
                const src = this.ctx.createBufferSource();
                src.buffer = b;
                const g = this.ctx.createGain();
                g.gain.setValueAtTime(0.4, t);
                g.gain.exponentialRampToValueAtTime(0.01, t+0.1);
                src.connect(g); g.connect(this.masterGain); g.connect(this.reverb);
                src.start(t);
            }

            playHiHat(t) {
                const osc = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                const f = this.ctx.createBiquadFilter();
                osc.type = 'square'; osc.frequency.value = 8000;
                f.type = 'highpass'; f.frequency.value = 7000;
                g.gain.setValueAtTime(0.1, t);
                g.gain.exponentialRampToValueAtTime(0.01, t+0.05);
                osc.connect(f); f.connect(g); g.connect(this.masterGain);
                osc.start(t); osc.stop(t+0.05);
            }

            playBass(t) {
                const osc = this.ctx.createOscillator();
                const g = this.ctx.createGain();
                const f = this.ctx.createBiquadFilter();
                osc.type = 'sawtooth'; osc.frequency.setValueAtTime(55, t);
                f.type = 'lowpass'; f.Q.value = 10;
                f.frequency.setValueAtTime(200, t);
                f.frequency.linearRampToValueAtTime(800, t+0.1);
                f.frequency.linearRampToValueAtTime(200, t+0.2);
                g.gain.setValueAtTime(0.3, t);
                g.gain.linearRampToValueAtTime(0, t+0.2);
                osc.connect(f); f.connect(g); g.connect(this.masterGain);
                osc.start(t); osc.stop(t+0.2);
            }

            schedule(step, t) {
                if(ASSETS[0].active && step===0) this.playTone(220, 'triangle', t, 3, 0.1); // Pad
                if(ASSETS[1].active && [2,5,8,11,14].includes(step)) this.playBass(t); // Acid
                if(ASSETS[2].active && step%8===4) this.playSnare(t); // Snare
                if(ASSETS[3].active && step%2===0) this.playHiHat(t); // Hats
                if(ASSETS[4].active && step===0) this.playTone(40, 'sine', t, 0.8, 0.6); // Sub
                if(ASSETS[5].active && [12,14].includes(step)) this.playTone(880, 'square', t, 0.1, 0.05); // Lead
                if(ASSETS[6].active && step%4===0) this.playKick(t); // Kick
            }

            start() {
                this.isPlaying = true;
                this.resume();
                let step = 0;
                let nextTime = this.ctx.currentTime;
                
                this.timerID = setInterval(() => {
                    const now = this.ctx.currentTime;
                    while(nextTime < now + 0.1) {
                        this.schedule(step, nextTime);
                        document.getElementById('play-head').style.width = (step/16)*100 + '%';
                        step = (step + 1) % 16;
                        nextTime += (60/this.tempo)/4;
                    }
                }, 25);
            }

            stop() {
                this.isPlaying = false;
                clearInterval(this.timerID);
                document.getElementById('play-head').style.width = '0%';
            }
        }

        const synthApp = {
            audio: new AudioEngine(),
            selectedId: 0,

            init: () => {
                synthApp.renderSequencer();
                synthApp.selectTrack(0);
                // synthApp.animateBg(); // REMOVED: Canvas was replaced by CSS blobs
                synthApp.initVisualizer();
                synthApp.initVideoHover();
            },

            initVideoHover: () => {
                const v = document.getElementById('timbreVideo');
                v.parentElement.addEventListener('mouseenter', () => v.muted = false);
                v.parentElement.addEventListener('mouseleave', () => v.muted = true);
            },

            togglePlay: () => {
                const btn = document.getElementById('playBtn');
                if(synthApp.audio.isPlaying) {
                    synthApp.audio.stop();
                    btn.innerText = "INITIALIZE SEQUENCE";
                    btn.style.borderColor = "var(--glass-border)";
                    btn.style.color = "var(--ethereal-cyan)";
                    btn.style.background = "transparent";
                } else {
                    synthApp.audio.start();
                    btn.innerText = "HALT SYSTEM";
                    btn.style.borderColor = "transparent";
                    btn.style.color = "#fff";
                    btn.style.background = "var(--ethereal-cyan)";
                    btn.style.boxShadow = "0 0 20px var(--glow-color)";
                }
            },

            toggleAll: (val) => {
                ASSETS.forEach(a => a.active = val);
                synthApp.renderSequencer();
            },

            toggleTrack: (e, id) => {
                e.stopPropagation();
                const a = ASSETS.find(x => x.id === id);
                a.active = !a.active;
                synthApp.renderSequencer();
            },

            selectTrack: (id) => {
                synthApp.selectedId = id;
                const data = ASSETS.find(x => x.id === id);
                
                document.getElementById('displayTitle').innerText = data.move.split('(')[0];
                document.getElementById('displaySubtitle').innerText = data.inst;
                document.getElementById('displayText').innerText = data.desc;
                
                const img = document.getElementById('mainImage');
                img.style.opacity = 0;
                setTimeout(() => {
                    img.src = data.imageSrc; 
                    img.onerror = () => { img.src = `https://placehold.co/600x400/111/FFF?text=${encodeURIComponent(data.move.split('(')[0])}`; };
                    img.onload = () => { img.style.opacity = 0.9; };
                }, 200);

                const vid = document.getElementById('timbreVideo');
                vid.src = data.timbreVideoSrc;
                vid.play().catch(()=>{});

                synthApp.renderSequencer();
            }, // Added closing brace and comma

            renderSequencer: () => {
                const list = document.getElementById('trackList');
                list.innerHTML = '';
                
                ASSETS.forEach(a => {
                    const card = document.createElement('div');
                    // New Classes for Ethereal Design
                    card.className = `seq-item ${a.active ? 'active' : ''} ${synthApp.selectedId === a.id ? 'selected' : ''}`;
                    card.onclick = () => synthApp.selectTrack(a.id);
                    
                    card.innerHTML = `
                        <div>
                            <div class="seq-name" style="opacity:${a.active ? '1' : '0.6'}">${a.move.split('(')[0]}</div>
                            <div class="seq-inst">${a.inst}</div>
                        </div>
                        <div class="seq-toggle" onclick="synthApp.toggleTrack(event, ${a.id})"></div>
                    `;
                    list.appendChild(card);
                });
            },

            initVisualizer: () => {
                const cvs = document.getElementById('scopeCanvas');
                const ctx = cvs.getContext('2d');
                const draw = () => {
                    requestAnimationFrame(draw);
                    if(synthApp.audio.analyser) {
                        const data = new Uint8Array(synthApp.audio.analyser.frequencyBinCount);
                        synthApp.audio.analyser.getByteTimeDomainData(data);
                        ctx.clearRect(0,0,cvs.width,cvs.height);
                        ctx.lineWidth = 2;
                        // CHANGED TO GOLD
                        ctx.strokeStyle = '#ffae00'; 
                        ctx.beginPath();
                        const slice = cvs.width * 1.0 / data.length;
                        let x = 0;
                        for(let i=0; i<data.length; i++) {
                            const v = data[i] / 128.0;
                            const y = v * cvs.height/2;
                            if(i===0) ctx.moveTo(x,y); else ctx.lineTo(x,y);
                            x += slice;
                        }
                        ctx.lineTo(cvs.width, cvs.height/2);
                        ctx.stroke();
                    }
                };
                draw();
            }
        };

        synthApp.init();

        // --- 5. Outro: The Infinite Black & White World ---
        (function() {
            const container = document.getElementById('outro-canvas-container');
            if(!container) return;

            const scene = new THREE.Scene();
            scene.background = new THREE.Color(0x000000); 
            scene.fog = new THREE.FogExp2(0x000000, 0.02); 

            const camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.set(0, 5, 45); 

            const renderer = new THREE.WebGLRenderer({ antialias: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.shadowMap.enabled = true;
            renderer.shadowMap.type = THREE.PCFSoftShadowMap; 
            renderer.toneMapping = THREE.ACESFilmicToneMapping; 
            renderer.toneMappingExposure = 1.2; 
            container.appendChild(renderer.domElement);

            const controls = new THREE.OrbitControls(camera, renderer.domElement);
            controls.enableDamping = true;
            controls.dampingFactor = 0.05;
            controls.autoRotate = true;
            controls.autoRotateSpeed = 0.5;
            controls.maxPolarAngle = Math.PI / 2 - 0.05; 
            controls.minDistance = 10;
            controls.maxDistance = 100;
            controls.enableZoom = false; 
            controls.enablePan = false;

            function createNoiseTexture() {
                const size = 512; const canvas = document.createElement('canvas'); canvas.width = size; canvas.height = size; const ctx = canvas.getContext('2d'); ctx.fillStyle = '#ffffff'; ctx.fillRect(0, 0, size, size);
                for (let i = 0; i < 20000; i++) { const x = Math.random() * size; const y = Math.random() * size; const val = Math.random() * 20 + 235; ctx.fillStyle = `rgb(${val},${val},${val})`; ctx.fillRect(x, y, 2, 2); }
                const texture = new THREE.CanvasTexture(canvas); texture.wrapS = THREE.RepeatWrapping; texture.wrapT = THREE.RepeatWrapping; texture.repeat.set(20, 20); return texture;
            }
            const iceTexture = createNoiseTexture();
            const planeGeo = new THREE.PlaneGeometry(1000, 1000, 256, 256); 
            const posAttribute = planeGeo.attributes.position;
            for (let i = 0; i < posAttribute.count; i++) {
                const x = posAttribute.getX(i); const y = posAttribute.getY(i);
                const z = Math.sin(x * 0.02) * Math.cos(y * 0.02) * 1.5 + Math.random() * 0.1;
                posAttribute.setZ(i, z);
            }
            planeGeo.computeVertexNormals();

            const planeMat = new THREE.MeshStandardMaterial({ 
                color: 0xffffff, 
                map: iceTexture, 
                roughness: 0.9, 
                metalness: 0.1, 
                bumpMap: iceTexture, 
                bumpScale: 0.05 
            });
            const ground = new THREE.Mesh(planeGeo, planeMat);
            ground.rotation.x = -Math.PI / 2;
            ground.receiveShadow = true;
            scene.add(ground);

            const lineGeo = new THREE.BufferGeometry();
            const lineCount = 400; 
            const linePos = [];
            for(let i=0; i<lineCount; i++) {
                const x = (Math.random() - 0.5) * 150;
                const z = (Math.random() - 0.5) * 150;
                const y = Math.random() * 100;
                linePos.push(x, y, z);
                linePos.push(x, y + 5 + Math.random() * 5, z); 
            }
            lineGeo.setAttribute('position', new THREE.Float32BufferAttribute(linePos, 3));
            const lineMat = new THREE.LineBasicMaterial({
                color: 0xffffff, 
                transparent: true,
                opacity: 0.15,
                blending: THREE.AdditiveBlending
            });
            const risingLines = new THREE.LineSegments(lineGeo, lineMat);
            scene.add(risingLines);

            const doorGroup = new THREE.Group();
            
            function getLightTexture() {
                const canvas = document.createElement('canvas'); canvas.width = 64; canvas.height = 128; const ctx = canvas.getContext('2d');
                const grd = ctx.createRadialGradient(32, 64, 5, 32, 64, 60);
                grd.addColorStop(0, "rgba(255, 220, 180, 1)"); 
                grd.addColorStop(0.4, "rgba(255, 140, 0, 0.8)"); 
                grd.addColorStop(1, "rgba(255, 100, 0, 0)"); 
                ctx.fillStyle = grd; ctx.fillRect(0, 0, 64, 128);
                return new THREE.CanvasTexture(canvas);
            }

            const sheetGeo = new THREE.PlaneGeometry(4, 8); 
            const sheetMat = new THREE.MeshBasicMaterial({ 
                map: getLightTexture(),
                color: 0xffaa00, side: THREE.DoubleSide, transparent: true, opacity: 0.9, blending: THREE.AdditiveBlending, depthWrite: false 
            });
            const sheet = new THREE.Mesh(sheetGeo, sheetMat);
            sheet.position.y = 4; 

            const borderGeo = new THREE.BoxGeometry(4.2, 8.2, 0.1); 
            const borderMat = new THREE.MeshBasicMaterial({ color: 0xffffff, transparent: true, opacity: 0.05, blending: THREE.AdditiveBlending });
            const border = new THREE.Mesh(borderGeo, borderMat); border.position.y = 4;

            const edges = new THREE.EdgesGeometry(borderGeo);
            const rimMat = new THREE.LineBasicMaterial({ color: 0xffaa00, transparent: true, opacity: 0.5, blending: THREE.AdditiveBlending });
            const rims = new THREE.LineSegments(edges, rimMat); rims.position.y = 4;

            doorGroup.add(sheet); doorGroup.add(border); doorGroup.add(rims);
            scene.add(doorGroup);

            const ambient = new THREE.AmbientLight(0x404040, 1.5); 
            scene.add(ambient);
            
            const spotLight = new THREE.SpotLight(0xffaa00, 10, 60, 0.5, 0.5, 1);
            spotLight.position.set(0, 20, 10);
            spotLight.target = doorGroup;
            spotLight.castShadow = true;
            scene.add(spotLight);

            const pLight = new THREE.PointLight(0xffaa00, 3, 20);
            pLight.position.set(0, 4, 2);
            scene.add(pLight);

            const textContent = "Beyond this door, there is nothing. No correct answers, no defined self, no singular path—only freedom.\n\nAs Song Dynasty Zen Master Wumen Huikai wrote:\n'The Great Way has no gate, yet there are a thousand paths.'\n\nThe true way has no fixed form. Though its formlessness may be bewildering, your own unique path is always there.";
            const textEl = document.getElementById('outro-text');
            let hasTyped = false;

            const outroObserver = new IntersectionObserver((entries) => {
                entries.forEach(entry => {
                    if(entry.isIntersecting && !hasTyped) {
                        hasTyped = true;
                        textEl.classList.add('visible');
                        let i = 0;
                        function type() {
                            if (i < textContent.length) {
                                textEl.innerText += textContent.charAt(i);
                                i++;
                                setTimeout(type, 30); 
                            }
                        }
                        type();
                    }
                });
            }, { threshold: 0.1 });
            outroObserver.observe(container);

            function animateScene() {
                requestAnimationFrame(animateScene);
                controls.update();
                const t = Date.now() * 0.002;
                
                sheet.material.opacity = 0.8 + Math.sin(t * 3) * 0.1;
                pLight.intensity = 3 + Math.sin(t * 5) * 1.0;

                const pos = risingLines.geometry.attributes.position.array;
                for(let i=1; i<pos.length; i+=3) {
                    pos[i] += 0.15; 
                    if(pos[i] > 100) pos[i] = 0; 
                }
                risingLines.geometry.attributes.position.needsUpdate = true;

                renderer.render(scene, camera);
            }
            animateScene();

            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
        })();
    </script>
</body>
</html>
